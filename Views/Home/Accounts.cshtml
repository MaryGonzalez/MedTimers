@*ALL USER ACCOUNTS*@
@*ADMINISTRATOR ACCESS ONLY*@

@model IEnumerable<MedTimers.Models.Users>

@{
    ViewData["Title"] = "MedTimers";
    Layout = "";
}
<link rel="shortcut icon" href="~/Images/clock.PNG" />
<link rel="stylesheet" href="~/css/StyleSheet.css"/>

@*User access based on account type, 1:Administrator*@
@if (ViewBag.userType == "1")
{
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

       
        @*Drop Down Menu*@
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" />
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css" />
        <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>

        @*Fonts*@
        <script src='https://kit.fontawesome.com/a076d05399.js' crossorigin='anonymous'></script>

        <!--DataTable-->
        <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
        <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
        <link href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css" rel="stylesheet">
        <script type="text/javascript" src="https://cdn.datatables.net/fixedcolumns/3.2.2/js/dataTables.fixedColumns.min.js"></script>


        <!--Pencil Icon Edit Button-->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css">

        <!--Delete Button-->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>

        <!--Default Password-->
        <link rel="https://brand.workingsolutions.com/components/css/wsol-components.css"/>
        <script src="https://brand.workingsolutions.com/components/js/react-embed.js"></script>

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
        <script src="~/js/site.js"></script>
        <script src="~/js/Account.js"></script>
            
        <link rel="stylesheet" href="~/css/Accounts.css">

    </head>
    <body>
        <div class="row headTitleAcct">
            <div class="col-sm-12 titlebox" style="background-color:#43444D; ">
                <div class="userLinks1">
                    <span>
                        @*Link to Home page*@
                        <button type="button" class="button button-small userBtn" onclick="location.href='@Url.Action("PatientData", "Home")'">Home</button>
                    </span> |
                    @*Link to Transfers page*@
                    <span><button type="button" class="button button-small userBtn" onclick="location.href='@Url.Action("Transfers", "Home")'">Transfers</button></span> |
                    
                     @*Link to Cert page*@
                    <span><button type="button" class="button button-small userBtn" onclick="location.href='@Url.Action("Cert", "Home")'">Cert</button></span>
                </div>


                <div class="userLinks2">
                     @*Link to Accounts page*@
                    <span><button type="button" class="button button-small userBtn" onclick="location.href='@Url.Action("Accounts", "Home")'">Accounts</button></span> |
                    
                    @*Link to Reports page*@
                    <span><button type="button" class="button button-small userBtn" onclick="location.href='@Url.Action("Reports", "Home")'">Reports</button></span>
                </div>

                @*Application title*@
                <p class="medTitle">MedTimers</p>

            </div>
        </div>

    


        <div class="patientContainer">
            <div class="row">

                <div class="col-12 newPatient">
                    <div class="container-fluid accountContainer" style="padding-left:15% !important">

                        <div class="accountSearch">
                            <p style="color: white; font-size: 25px; margin-left: 7px; margin-top: 4px; margin-bottom: -40px">User Accounts</p> 
                            <button type="button" class="btn btn-outline-light newAcct" style="position:absolute; z-index:1; margin-left:32%" onclick="location.href='@Url.Action("NewAccount", "Home")'">+ ADD ACCOUNT</button>
                        </div>

                         <div class="row acctRow">
                           <div class="column columnAccount">
                        <table class="table tableAccount"  id="tableAccount">
                            <thead>
                                <tr>
                                    <th style="text-align: center; width: 11%">
                                        Edit
                                    </th>
                                    <th>
                                        Name
                                    </th>
                                    <th>
                                        Email
                                    </th>
                                    <th>
                                        Username
                                    </th>
                                    <th>
                                        Account Type
                                    </th>
                                    <th>
                                        Last Login
                                    </th>
                               
                                </tr>
                            </thead>
                            <tbody id="accountTableBody">
                                @*If patient data is not null, display table*@
                                @if (Model != null)                                
                                {
                                    @foreach (var item in Model)
                                    {                                           
                                                <tr>
                                                     @*Pencil icon to edit a user*@
                                                    <td><a href="@Url.Action("EditAccount", "Home", new { UserID = item.UserID })" class="button button-small editAccount"><i style="font-size: 20px; color: black; margin-left: 45px;" class="fa fa-pencil"></i></a></td>

                                                    <td style="text-align:center">@Html.DisplayFor(modelItem => item.fullName)</td>
                                                    <td style="text-align:center">@Html.DisplayFor(modelItem => item.User_Email)</td>
                                                    <td style="text-align:center">@Html.DisplayFor(modelItem => item.Username)</td>
                                                    <td style="text-align:center">@Html.DisplayFor(modelItem => item.UserType)</td>

                                                    @*Display datetime of last login if it is not equal to minimum date*@
                                                    @if (item.User_LastLogin != DateTime.MinValue)
                                                    {
                                                        @*If the last login is greater than 90 days from current date, color = red*@
                                                        if (DateTime.Today > item.User_LastLogin.Date.AddDays(90))
                                                        {

                                                            <td style="color:red; text-align:center">@Html.DisplayFor(modelItem => item.User_LastLogin)</td>
                                                        }

                                                        @*If the last login is less than 90 days from current date, color = black*@
                                                        else
                                                        {
                                                            <td style="color:black; text-align:center">@Html.DisplayFor(modelItem => item.User_LastLogin)</td>
                                                        }
                                                    }
                                                    else
                                                    {
                                                        <td></td>
                                                    }
                                                </tr>
                                         
                                      }
                                 }
                                 @*If user data is null, display empty table*@
                                        else
                                        {
                                            <tr>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                            </tr>

                                        }

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
             </div>
            </div>
        </div>


        <script>
            //Data Table
       $('#tableAccount').DataTable({
        "ordering": false,
        "order": [],  // not set any order rule for any column.
        "scrollX": true,
        //Options for drop down menu - show entries
        "lengthMenu": [[15, 25, 50, -1], [15, 25, 50, "All"]],

        //Number of entries per page
        "pageLength": 15
    });
            </script>

    </body>
</html>
}

@*If user does not have access to this page, display error message*@
else
{
<div style="margin-left:44%; margin-top:8%">

  <div class='error-circle'>
    <div style="font-family: sans-serif;">X</div>
  </div>

  <h3 style="text-align:center; font-size:29px; margin-left:-84%; font-family: sans-serif;">Access Denied</h3>
  <p style="text-align:center; margin-left: -83%; font-size: 19px; font-family: sans-serif;">You do not have permission to view this page.</p>
  <p style="text-align:center; margin-left: -83%; font-size: 19px; font-family: sans-serif;">Please check your credentials and try again</p>
</div>
}

